Version 4
SHEET 1 2664 1268
WIRE 784 -640 784 -704
WIRE 1456 -480 1440 -480
WIRE 1568 -480 1456 -480
WIRE 784 -448 784 -560
WIRE 208 -400 160 -400
WIRE 480 -400 208 -400
WIRE 592 -400 480 -400
WIRE 624 -400 592 -400
WIRE 752 -400 704 -400
WIRE 784 -400 784 -448
WIRE 784 -400 752 -400
WIRE 832 -400 784 -400
WIRE 848 -400 832 -400
WIRE 1328 -400 1040 -400
WIRE 1376 -400 1328 -400
WIRE 1456 -400 1456 -480
WIRE 1456 -400 1440 -400
WIRE 1504 -400 1456 -400
WIRE 480 -368 480 -400
WIRE 752 -368 752 -400
WIRE 160 -352 160 -400
WIRE 288 -352 224 -352
WIRE 368 -352 352 -352
WIRE 1328 -336 1328 -400
WIRE 1040 -304 1040 -400
WIRE 224 -272 224 -352
WIRE 224 -272 208 -272
WIRE 240 -272 224 -272
WIRE 256 -272 240 -272
WIRE 368 -272 368 -352
WIRE 368 -272 336 -272
WIRE 1200 -272 1152 -272
WIRE 1568 -272 1456 -272
WIRE 1600 -272 1568 -272
WIRE 592 -256 592 -400
WIRE 752 -256 752 -288
WIRE 240 -240 240 -272
WIRE 1568 -240 1568 -272
WIRE 544 -224 592 -256
WIRE 816 -224 752 -256
WIRE 240 -208 240 -240
WIRE 320 -208 240 -240
WIRE 1040 -192 1040 -240
WIRE 1152 -192 1040 -192
WIRE 1200 -192 1152 -192
WIRE 1504 -192 1504 -400
WIRE 1504 -192 1456 -192
WIRE 544 -144 544 -224
WIRE 576 -144 544 -144
WIRE 816 -144 816 -224
WIRE 816 -144 768 -144
WIRE 1152 -112 1104 -112
WIRE 1200 -112 1152 -112
WIRE 1584 -112 1456 -112
WIRE 80 -96 -112 -96
WIRE 96 -96 80 -96
WIRE 160 -96 160 -256
WIRE 160 -96 96 -96
WIRE 224 -96 160 -96
WIRE 240 -96 240 -128
WIRE 240 -96 224 -96
WIRE 320 -96 320 -144
WIRE 320 -96 240 -96
WIRE 816 -96 816 -144
WIRE 816 -96 768 -96
WIRE 576 -48 512 -48
WIRE 832 -48 832 -400
WIRE 832 -48 768 -48
WIRE -112 80 -112 -96
WIRE 816 112 768 112
WIRE 848 112 816 112
WIRE 944 112 848 112
WIRE 992 112 944 112
WIRE 1104 112 1072 112
WIRE 1120 112 1120 96
WIRE 1120 112 1104 112
WIRE 1584 112 1120 112
WIRE 96 128 96 -96
WIRE 848 128 848 112
WIRE 944 128 944 112
WIRE 1104 144 1104 112
WIRE 224 160 224 -96
WIRE 336 160 304 160
WIRE 432 160 400 160
WIRE -112 208 -112 160
WIRE 944 208 944 192
WIRE 304 240 304 160
WIRE 304 240 272 240
WIRE 320 240 304 240
WIRE 336 240 320 240
WIRE 432 240 432 160
WIRE 432 240 416 240
WIRE 480 240 432 240
WIRE 320 256 320 240
WIRE -112 320 -112 288
WIRE 96 320 96 192
WIRE 96 320 -112 320
WIRE 224 320 224 256
WIRE 224 320 96 320
WIRE 224 384 224 320
WIRE 320 384 320 336
WIRE 320 384 224 384
WIRE 224 432 224 384
WIRE 448 544 256 544
WIRE 576 544 448 544
WIRE 992 544 576 544
WIRE 1600 544 1072 544
WIRE 256 592 256 544
WIRE 576 592 576 544
WIRE 336 608 304 608
WIRE 336 704 336 608
WIRE 576 704 576 672
WIRE 576 704 336 704
WIRE 96 736 -112 736
WIRE 256 736 256 688
WIRE 256 736 96 736
WIRE 256 784 256 736
WIRE 640 784 624 784
WIRE 656 784 640 784
WIRE 1600 784 736 784
WIRE 640 816 640 784
WIRE -112 848 -112 736
WIRE 336 864 336 704
WIRE 336 864 304 864
WIRE 576 912 576 800
WIRE 640 912 640 896
WIRE 640 912 576 912
WIRE 256 928 256 880
WIRE 576 928 576 912
FLAG 2048 96 0
FLAG 2048 16 VCC
FLAG 1936 96 0
FLAG 224 432 0
FLAG 848 208 0
FLAG 816 112 ISNS
FLAG 512 -48 0
FLAG 784 -704 VCC
FLAG 1936 16 Vpwm
FLAG 576 928 0
FLAG 368 -272 ADRV
FLAG 1600 784 Vpwm
FLAG 80 -96 solout
FLAG 912 -400 0
FLAG 1152 -272 ADRV
FLAG 1152 -112 DDRV
FLAG 1152 -192 solout
FLAG 1600 -272 3p3V
FLAG 1584 -112 Vpwm
FLAG 1328 -48 0
FLAG 2160 96 0
FLAG 2160 16 3p3V
FLAG 944 208 0
FLAG 480 -304 0
FLAG 784 -448 Vccint
FLAG 256 928 0
FLAG -112 928 0
FLAG 448 544 Vlevelshift
FLAG 96 736 highZout
FLAG 1120 32 3p3V
FLAG 1104 208 0
FLAG 1024 -112 0
FLAG 1568 -176 0
FLAG 2272 96 0
FLAG 2272 16 Vlevelshift
FLAG 480 240 DDRV
FLAG 1376 -480 0
FLAG 208 -400 dm1
FLAG 1568 -480 Vlevelshift
SYMBOL ind -128 64 R0
SYMATTR InstName L1
SYMATTR Value {Lsol}
SYMBOL res -128 192 R0
SYMATTR InstName R1
SYMATTR Value {Rsol}
SYMBOL nmos 208 -352 M0
WINDOW 3 124 102 VLeft 2
SYMATTR Value BUK9K5260E
SYMATTR InstName M1
SYMBOL voltage 2048 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 24
SYMBOL voltage 1936 0 R0
WINDOW 3 -60 18 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 3.3 0 100n 100n {Dctl} 100u)
SYMATTR InstName V2
SYMBOL res 720 -416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 4m
SYMBOL res 736 -384 R0
SYMATTR InstName R6
SYMATTR Value 20
SYMBOL res 832 112 R0
SYMATTR InstName R7
SYMATTR Value 4.99k
SYMBOL OpAmps\\LTC6102 672 -32 R0
SYMATTR InstName U2
SYMBOL nmos 624 704 M0
WINDOW 3 -51 -14 Left 2
SYMATTR Value 2N7002
SYMATTR InstName M2
SYMBOL cap 848 -384 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C4
SYMATTR Value 33µ
SYMBOL PowerProducts\\LTC4449 1328 -192 M0
SYMATTR InstName U1
SYMBOL cap 1024 -304 R0
SYMATTR InstName C1
SYMATTR Value 0.47µ
SYMBOL res 352 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value {Rhs}
SYMBOL res 752 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1
SYMBOL schottky 1440 -416 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 43 25 VTop 2
SYMATTR InstName D2
SYMATTR Value PMEG6010AED
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage 2160 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 3.3
SYMBOL cap 928 128 R0
SYMATTR InstName C2
SYMATTR Value 0.1µ
SYMBOL zener 336 -144 R180
WINDOW 0 -44 34 Left 2
WINDOW 3 -155 0 Left 2
SYMATTR InstName D3
SYMATTR Value BZX84B18VLY
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 224 -224 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res 624 800 R0
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL TVSdiode 112 192 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -21 -21 VRight 2
SYMATTR InstName D4
SYMATTR Value SMCJ33A
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap 464 -368 R0
SYMATTR InstName C3
SYMATTR Value 22µ
SYMBOL res 768 -656 R0
SYMATTR InstName R9
SYMATTR Value 1m
SYMBOL res 560 576 R0
SYMATTR InstName R10
SYMATTR Value 3.3k
SYMBOL res -128 832 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL nmos 304 784 M0
SYMATTR InstName M3
SYMATTR Value 2N7002
SYMBOL pmos 304 688 R180
SYMATTR InstName M4
SYMATTR Value BSS84
SYMBOL res 1088 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 4.99
SYMBOL diode 1120 208 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMBOL schottky 1136 96 R180
WINDOW 0 34 54 Left 2
WINDOW 3 -172 11 Left 2
SYMATTR InstName D5
SYMATTR Value RBR3LAM30A
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 1120 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value {Rnop}
SYMBOL cap 1552 -240 R0
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL voltage 2272 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 5
SYMBOL res 1088 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 1
SYMBOL nmos 272 160 M0
WINDOW 3 66 5 VLeft 2
SYMATTR Value BUK9K5260E
SYMATTR InstName M5
SYMBOL res 432 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 10
SYMBOL res 336 352 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R16
SYMATTR Value 4.99k
SYMBOL diode 288 -336 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 336 176 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL cap 1376 -464 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C6
SYMATTR Value 10µ
TEXT -984 -880 Left 2 !.tran 0 {2*tauLR+20m} {2*tauLR}
TEXT -200 392 Left 2 ;Solenoid
TEXT 1944 -464 Left 2 !.param Cfb1=0.1u
TEXT 1944 -432 Left 2 !.param Rfb1=10k
TEXT 1944 -400 Left 2 !.param Rfb2=1k
TEXT 1984 -344 Left 2 !.param Rnop=10MEG
TEXT 1984 -312 Left 2 !.param Rjmp=1m
TEXT 1944 -496 Left 2 !.param Cfb2=1p
TEXT 1992 -280 Left 2 ;Rnop is do not populate for testing\nRjmp is jumper for testing
TEXT 1944 -528 Left 2 ;feedback type 2 comp
TEXT -984 -8 Left 2 !.param Lsol=11.2m
TEXT -984 16 Left 2 !.param Rsol=20.8
TEXT -976 -40 Left 2 ;Solenoid definition
TEXT -984 48 Left 2 !.param Imax=1.5
TEXT -984 -1080 Left 4 ;hoang pham\n8/28/2023\nAIM homework
TEXT 1992 -200 Left 2 !.param Vctlmx=3.3
TEXT 168 -456 Left 2 !.param Rhs=10
TEXT -984 -776 Left 2 !*.step param Dctl list 20u 40u 60u 80u
TEXT -984 80 Left 2 !.param tauLR={2*PI*Lsol/Rsol}
TEXT -984 -928 Left 2 ;save data in steady state
TEXT 872 -616 Left 2 ;field \nreplaceable fuse
TEXT 1600 120 Left 2 ;to ADC
TEXT -192 688 Left 2 ;high Z load
TEXT 1616 544 Left 2 ;5-12V
TEXT 1600 144 Left 2 ;0-3.3V
TEXT 1600 824 Left 2 ;0-3.3V
TEXT 1592 -80 Left 2 ;0-3.3V
TEXT -984 -736 Left 2 !.meas tran Isol RMS I(L1)
TEXT 1992 -160 Left 2 !.param Dctl=60u
TEXT -984 -832 Left 2 ;use to characterize current v duty cycle
TEXT -984 -800 Left 2 ;**************************************
TEXT -984 -640 Left 2 ;**************************************
TEXT -984 -616 Left 2 !*.step param Rhs list 1 3.3 4.99 10
TEXT -984 -672 Left 2 ;use to characterize inrush v R gate
TEXT -984 -576 Left 2 !.meas tran Idpk MAX Id(M1)
TEXT -984 -528 Left 2 ;use to characterize levelshifter timing
TEXT -984 -496 Left 2 ;**************************************
TEXT -984 -896 Left 2 ;**************************************
TEXT -984 -376 Left 2 !.meas tran Iin RMS I(V1)
TEXT -984 -432 Left 2 ;use to characterize efficiency
TEXT -984 -400 Left 2 ;**************************************
TEXT -984 -312 Left 2 !.meas tran pQls RMS Id(M5)*V(solout)
TEXT -984 -272 Left 2 !.meas tran pQhs rms Id(m1)*(V(dm1)-V(solout))
TEXT -984 -344 Left 2 !.meas tran Iinavg AVG I(V1)
TEXT -984 -240 Left 2 !.meas tran Iu1 rms I(D8)
TEXT -984 -208 Left 2 !.meas tran pin rms V(Vccint)*I(R9)
TEXT -984 -176 Left 2 !.meas tran pout rms I(R1)*I(R1)*{Rsol}
RECTANGLE Normal 0 496 -240 -144 2
RECTANGLE Normal 848 -528 736 -672 2
RECTANGLE Normal 1536 1040 32 -512 2
RECTANGLE Normal 16 1040 -240 624 2
